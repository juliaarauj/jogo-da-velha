<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Jogo da Velha | Cyber Grid Plus</title>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet" />
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    body {
      background-color: #1a1a2e;
      color: #e94560;
      font-family: 'Orbitron', sans-serif;
      text-align: center;
      padding: 20px;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      overflow: hidden;
    }
    h1 {
      color: #66ff00;
      font-size: 3.5rem;
      text-shadow: 0 0 5px #66ff00, 0 0 10px #66ff00, 0 0 20px #00ff00;
      margin-bottom: 10px;
    }
    .placar {
      font-size: 1.5rem;
      margin-bottom: 20px;
      color: #fff;
    }
    .tabuleiro {
      background: #0f0f1a;
      display: grid;
      grid-template-columns: repeat(3, 130px);
      grid-template-rows: repeat(3, 130px);
      gap: 10px;
      padding: 15px;
      border-radius: 10px;
      border: 3px solid #3f3f6e;
      box-shadow: 0 0 15px rgba(102, 255, 0, 0.5);
    }
    .casa {
      background: #2b2b45;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 6rem;
      cursor: pointer;
      border: 1px solid #4a4e69;
      transition: background-color 0.2s, transform 0.2s;
      user-select: none;
      border-radius: 5px;
      opacity: 0;
    }
    .casa.aparecer {
      animation: fadeIn 0.3s forwards;
    }
    .casa:hover {
      background-color: #3f3f6e;
      transform: scale(1.02);
    }
    .x-move {
      color: #ff00ff;
      text-shadow: 0 0 5px #ff00ff, 0 0 10px #ff00ff;
    }
    .o-move {
      color: #00ffff;
      text-shadow: 0 0 5px #00ffff, 0 0 10px #00ffff;
    }
    .vitoria {
      background-color: #66ff00 !important;
      box-shadow: 0 0 10px #66ff00, 0 0 20px #66ff00;
      animation: brilhar 1s infinite alternate;
    }
    @keyframes brilhar {
      from { transform: scale(1); }
      to { transform: scale(1.05); }
    }
    @keyframes fadeIn {
      to { opacity: 1; }
    }
    button {
      margin-top: 10px;
      padding: 10px 20px;
      font-size: 1rem;
      background-color: #66ff00;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      color: #000;
      font-weight: bold;
      box-shadow: 0 0 10px #66ff00;
      transition: background-color 0.2s;
    }
    button:hover {
      background-color: #52cc00;
    }
    /* Sobreposi√ß√£o central de resultado */
    .overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(0,0,0,0.8);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 10;
      pointer-events: none;
      opacity: 0;
      transition: opacity 0.3s;
    }
    .overlay.mostrar {
      pointer-events: auto;
      opacity: 1;
    }
    .overlay h2 {
      color: #66ff00;
      font-size: 4rem;
      text-shadow: 0 0 5px #66ff00, 0 0 10px #66ff00, 0 0 20px #00ff00;
    }
    .mute-btn {
      position: absolute;
      top: 20px;
      right: 20px;
      background: rgba(0,0,0,0.5);
      color: #fff;
      border: 2px solid #66ff00;
      border-radius: 5px;
      padding: 5px 10px;
      font-size: 1rem;
      cursor: pointer;
      z-index: 100;
    }
    /* canvas para part√≠culas */
    canvas {
      position: absolute;
      top: 0; left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 5;
    }
    /* tela inicial */
    .tela-inicial {
      position: absolute;
      top: 0; left: 0;
      width: 100vw; height: 100vh;
      background: rgba(0,0,0,0.9);
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      z-index: 20;
    }
    .tela-inicial h2 {
      color: #66ff00;
      font-size: 3rem;
      margin-bottom: 20px;
    }
    .tela-inicial button {
      margin: 10px;
    }
  </style>
</head>
<body>
  <h1>[ C Y B E R G R I D + ]</h1>
  <div class="placar" id="placar">
    üü£ X: 0 | üü¶ O: 0 | üîÑ Empates: 0
  </div>
  <div class="tabuleiro">
    <div class="casa"></div>
    <div class="casa"></div>
    <div class="casa"></div>
    <div class="casa"></div>
    <div.class="casa"></div>
    <div.class="casa"></div>
    <div.class="casa"></div>
    <div.class="casa"></div>
  </div>
  <button onclick="reiniciar()">üîÅ Nova Partida</button>
  <button onclick="zerarTudo()">üßπ Zerar Tudo</button>
  <button onclick="compartilharResultado()">üì§ Compartilhar Resultado</button>
  <button class="mute-btn" onclick="toggleMute()">üîá Mute</button>

  <audio id="som-vitoria" src="vitoria.mp3" preload="auto"></audio>
  <audio id="som-empate" src="empate.mp3" preload="auto"></audio>
  <audio id="som-jogada-x" src="jogada-x.mp3" preload="auto"></audio>
  <audio id="som-jogada-o" src="jogada-o.mp3" preload="auto"></audio>
  <audio id="musica-fundo" src="fundo.mp3" preload="auto" loop></audio>

  <canvas id="canvasParticulas"></canvas>

  <div class="overlay" id="overlay">
    <h2 id="textoResultado"></h2>
  </div>

  <div class="tela-inicial" id="telaInicial">
    <h2>Escolha o modo de jogo</h2>
    <button onclick="iniciarModo('pvp')">üë• Jogador vs Jogador</button>
    <button onclick="iniciarModo('cpu')">‚öôÔ∏è Jogador vs CPU</button>
  </div>

  <script>
    // ‚Äî‚Äî‚Äî‚Äî‚Äî Vari√°veis globais ‚Äî‚Äî‚Äî‚Äî‚Äî
    const casas = document.querySelectorAll(".casa");
    const placarEl = document.getElementById("placar");
    const overlay = document.getElementById("overlay");
    const textoResultado = document.getElementById("textoResultado");
    const telaInicial = document.getElementById("telaInicial");
    const canvas = document.getElementById("canvasParticulas");
    const ctx = canvas.getContext("2d");

    const somVitoria = document.getElementById("som-vitoria");
    const somEmpate = document.getElementById("som-empate");
    const somJogadaX = document.getElementById("som-jogada-x");
    const somJogadaO = document.getElementById("som-jogada-o");
    const musicaFundo = document.getElementById("musica-fundo");

    let jogador = "X";
    let vitorias = { X: 0, O: 0, empates: 0 };
    let jogoEncerrado = false;
    let modo = null; // 'pvp' ou 'cpu'
    let mute = false;

    // combina√ß√µes vencedoras
    const combinacoes = [
      [0,1,2],[3,4,5],[6,7,8],
      [0,3,6],[1,4,7],[2,5,8],
      [0,4,8],[2,4,6]
    ];

    // Ajusta canvas para ocupar full
    function redimensionarCanvas() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    }
    redimensionarCanvas();
    window.onresize = redimensionarCanvas;

    // Part√≠culas
    class Particula {
      constructor(x, y, cor) {
        this.x = x;
        this.y = y;
        this.velX = (Math.random()-0.5)*4;
        this.velY = (Math.random()-0.5)*4;
        this.alpha = 1;
        this.cor = cor;
      }
      atualizar() {
        this.x += this.velX;
        this.y += this.velY;
        this.alpha -= 0.02;
      }
      desenhar() {
        ctx.save();
        ctx.globalAlpha = this.alpha;
        ctx.fillStyle = this.cor;
        ctx.beginPath();
        ctx.arc(this.x, this.y, 4, 0, Math.PI*2);
        ctx.fill();
        ctx.restore();
      }
    }

    let particulas = [];
    function gerarParticulasNasCasas(casasIndices, cor) {
      casasIndices.forEach(idx => {
        const casaEl = casas[idx];
        const rect = casaEl.getBoundingClientRect();
        // gerar v√°rias part√≠culas dentro da casa
        for (let i = 0; i < 20; i++) {
          const x = rect.left + rect.width/2;
          const y = rect.top + rect.height/2;
          particulas.push(new Particula(x, y, cor));
        }
      });
    }
    function animarParticulas() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      for (let i = particulas.length - 1; i >= 0; i--) {
        const p = particulas[i];
        p.atualizar();
        if (p.alpha <= 0) {
          particulas.splice(i, 1);
        } else {
          p.desenhar();
        }
      }
      if (particulas.length > 0) {
        requestAnimationFrame(animarParticulas);
      }
    }

    // Inicializa√ß√£o do jogo
    casas.forEach(c => c.addEventListener("click", cliqueCasa));

    function iniciarModo(selModo) {
      modo = selModo;
      telaInicial.classList.remove("mostrar");
      telaInicial.style.display = "none";
      musicaFundo.play().catch(()=>{});
      atualizarPlacar();
      // revelar casas com anima√ß√£o
      casas.forEach((c, i) => {
        setTimeout(() => c.classList.add("aparecer"), i * 50);
      });
    }

    function cliqueCasa(e) {
      const casa = e.target;
      const idx = Array.from(casas).indexOf(casa);
      if (casa.textContent !== "" || jogoEncerrado || modo === null) return;

      aplicarJogada(casa, idx, jogador);
      if (!jogoEncerrado) {
        if (modo === 'cpu' && jogador === 'O') {
          // IA simples: escolher casa aleat√≥ria vazia
          setTimeout(() => {
            const vazias = Array.from(casas).map((c,i) => c.textContent === "" ? i : null).filter(i=>i!==null);
            if (vazias.length > 0) {
              const escolha = vazias[Math.floor(Math.random()*vazias.length)];
              aplicarJogada(casas[escolha], escolha, jogador);
            }
          }, 400);
        }
      }
    }

    function aplicarJogada(casaEl, idx, jogadorAtual) {
      casaEl.textContent = jogadorAtual;
      casaEl.classList.add(jogadorAtual === 'X' ? 'x-move' : 'o-move');

      // som de clique
      if (!mute) {
        if (jogadorAtual === 'X') somJogadaX.play().catch(()=>{});
        else somJogadaO.play().catch(()=>{});
      }

      if (checarVencedor(jogadorAtual)) {
        jogoEncerrado = true;
        vitorias[jogadorAtual]++;
        mostrarResultado("Jogador " + jogadorAtual + " venceu!");
        if (!mute) {
          somVitoria.play().catch(()=>{});
        }
        // gerar part√≠culas e anima√ß√£o
        const casasWin = combinacoes.find(cmb => {
          return cmb.every(i => casas[i].textContent === jogadorAtual);
        });
        casasWin.forEach(i => casas[i].classList.add('vitoria'));
        gerarParticulasNasCasas(casasWin, jogadorAtual === 'X' ? '#ff00ff' : '#00ffff');
        animarParticulas();
      } else if (checarEmpate()) {
        jogoEncerrado = true;
        vitorias.empates++;
        mostrarResultado("Empate!");
        if (!mute) somEmpate.play().catch(()=>{});
      } else {
        jogador = jogador === 'X' ? 'O' : 'X';
      }
      atualizarPlacar();
    }

    function checarVencedor(jog) {
      return combinacoes.some(cmb => {
        return cmb.every(i => casas[i].textContent === jog);
      });
    }
    function checarEmpate() {
      return Array.from(casas).every(c => c.textContent !== "");
    }

    function atualizarPlacar() {
      placarEl.textContent = `üü£ X: ${vitorias.X} | üü¶ O: ${vitorias.O} | üîÑ Empates: ${vitorias.empates}`;
    }

    function mostrarResultado(txt) {
      textoResultado.textContent = txt;
      overlay.classList.add("mostrar");
      // ao clicar na overlay, esconder e reiniciar
      overlay.onclick = () => {
        overlay.classList.remove("mostrar");
        reiniciar();
      };
    }

    function reiniciar() {
      casas.forEach(c => {
        c.textContent = "";
        c.classList.remove("x-move", "o-move", "vitoria", "aparecer");
      });
      jogoEncerrado = false;
      jogador = "X";
      particulas = [];
      ctx.clearRect(0,0,canvas.width,canvas.height);

      // reaparecer casas
      casas.forEach((c, i) => {
        setTimeout(() => c.classList.add("aparecer"), i * 50);
      });
    }

    function zerarTudo() {
      reiniciar();
      vitorias = { X: 0, O: 0, empates: 0 };
      atualizarPlacar();
    }

    function toggleMute() {
      mute = !mute;
      if (mute) {
        musicaFundo.pause();
      } else {
        musicaFundo.play().catch(()=>{});
      }
    }

    function compartilharResultado() {
      const texto = `Placar: X ${vitorias.X} | O ${vitorias.O} | Empates ${vitorias.empates}`;
      navigator.clipboard.writeText(texto).then(() => {
        alert("Resultado copiado para a √°rea de transfer√™ncia!");
      }).catch(() => {
        alert("Falha ao copiar resultado.");
      });
    }

    // desbloquear √°udio no primeiro clique do usu√°rio
    window.addEventListener('click', () => {
      musicaFundo.play().then(() => {
        musicaFundo.pause();
      }).catch(() => {});
    }, { once: true });

  </script>
</body>
</html>

